# Changelog

All notable changes to this project will be documented in this file.

## [Unreleased]

### Added
- **Star schema support in `all` command**: Full star schema support for batch exports
  - New format options: `--format duckdb-star`, `--format json-star`
  - Uses 25+ dimensional tables for richer analytics
  - Progress reporting shows row counts, DB size, and processing rate
- **Performance options for batch processing**:
  - `-j/--jobs N`: Parallel workers for processing (default: 1)
  - `--batch-size N`: Sessions per transaction batch (default: 10)
  - Progress callback now includes stats (rows_inserted, db_size_mb, rate)
- **Enhanced progress reporting**: Shows rows processed, storage size, and sessions/sec rate
- **Claude.ai account export import**: New `import` command to convert Claude.ai account exports (from Settings > Privacy)
  - Supports all existing output formats: HTML, DuckDB
  - Lists conversations: `ccutils import ./export --list`
  - Interactive selection: `ccutils import ./export --interactive`
  - Filter by conversation UUID: `ccutils import ./export -c <uuid>`
  - Preserves thinking blocks and tool calls
  - New parser functions: `parse_claude_ai_export()`, `convert_conversation_to_loglines()`
- **JSON export format**: Export sessions to JSON in addition to HTML and DuckDB
  - `--format json`: Simple schema (sessions, messages, tool_calls, thinking) in single JSON file
  - `--format json-star`: Star schema exported as directory structure (meta.json + dimensions/*.json + facts/*.json)
  - New `--schema` option to explicitly set schema type (`simple` or `star`)
  - Backwards-compatible: compound format names (`duckdb-star`, `json-star`) still work
  - New functions: `resolve_schema_format()`, `export_sessions_to_json()`, `export_star_schema_to_json()`
- **Multi-select for local command**: Select multiple sessions using SPACE, confirm with ENTER
- **DuckDB export from local command**: New `--format` option supports `html`, `duckdb`, `duckdb-star`, `json`, or `json-star`
- **Subagent support**: New `--include-subagents` flag auto-includes related agent sessions (recursive)
- **Agent metadata in DuckDB**: Sessions and messages now track agent relationships
  - Sessions table: `is_agent`, `agent_id`, `parent_session_id`, `depth_level` columns
  - Messages table: `is_sidechain` column
  - Star schema: Same columns in `dim_session` and `fact_messages`
- New functions: `extract_session_metadata()`, `find_agent_sessions()` for agent discovery

### Changed
- Expanded README documentation for star schema analytics with comparison table, quick start code, and overview of dimensions/facts
- `local` command now uses `questionary.checkbox()` for multi-select (was single-select)

### Added (continued)
- Full-text search across the entire HTML archive generated by the `all` command
  - Search index (`search-index.js`) is generated alongside HTML files
  - In-browser JavaScript search with snippet highlighting
  - Search works offline and on `file://` protocol (unlike existing per-session search)
  - Results show project, type, timestamp, and link directly to the matching content
  - Mobile-friendly responsive design
- New CLI option `--no-search-index` to skip search index generation for faster/smaller output
- New functions: `extract_searchable_content()`, `extract_snippet()` for search indexing
- DuckDB export for structured analytics on transcript data
  - Export sessions, messages, tool calls, and thinking blocks to a single DuckDB database
  - Query your transcripts with SQL for analytics and insights
  - New CLI option `--format` to choose output format: `html` (default), `duckdb`, or `both`
  - New CLI option `--include-thinking` to include thinking blocks in DuckDB export (opt-in, can be large)
  - New functions: `create_duckdb_schema()`, `export_session_to_duckdb()`, `generate_duckdb_archive()`
